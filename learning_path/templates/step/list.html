{% extends "base.html" %}
{% load static %}


{% block content %}

<style>
    .custom-img {
        max-height: 150px; /* Desired height */
        width: auto; /* Maintain aspect ratio */
        object-fit: cover; /* Cover the area */
    }
    /* Minimal custom CSS */
    .timeline {
        counter-reset: step-counter;
    }

    .timeline-item {
        position: relative;
        padding-left: 60px; /* Offset for the number circle */
        border: 1px solid gray;
        background-color: #f8f9fa;
        border-radius: 10px;
        margin-bottom: 20px;
    }

    /* Circle for step numbers */
    .timeline-item::before {
        counter-increment: step-counter;
        content: counter(step-counter);
        position: absolute;
        top: 20px;
        left: -35px;
        width: 45px;
        height: 45px;
        background-color: #007bff;
        color: #fff;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.2rem;
        font-weight: bold;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
</style>

<div class="container-fluid" style="margin-left: 10px;">
    <h1 class="text-center my-4">Steps for {{ learning_path.title }}</h1>
    
    <div class="d-flex justify-content-end mb-3">
        <a href="{% url 'learning_path:step_add' learning_path.id %}" class="btn btn-primary me-2">Add Step</a>
        <a href="{% url 'learning_path:learning_path_list' %}" class="btn btn-secondary">Back to Learning Paths</a>
    </div>

    <div class="timeline">
        <ol class="list-unstyled">
            {% for step in steps %}
                <li class="timeline-item p-4 shadow-sm">
                    <h4 class="fw-bold text-primary">{{ step.title }}</h4>
                    <p class="text-muted">{{ step.description }}</p>

                    <!-- Courses associated with each step, displayed in three columns -->
                    <div class="row g-4">
                        {% for course in step.courses.all %}
                            <!-- Image Column -->
                            <div class="col-md-4">
                                <div class="card h-100 shadow-sm">
                                    {% if course.image %}
                                        <img src="{{ course.image.url }}" class="card-img-top img-fluid custom-img" alt="Course image">
                                    {% else %}
                                        <img src="{% static 'images/default-course.jpeg' %}" class="card-img-top img-fluid custom-img" alt="Default course image">
                                    {% endif %}
                                </div>
                            </div>
                            <!-- Details Column -->
                            <div class="col-md-6">
                                <div class="card-body">
                                    <h5 class="card-title text-dark">{{ course.course_name }}</h5>
                                    <p class="card-text">{{ course.description|truncatewords:15 }}</p>
                                </div>
                            </div>
                            <!-- Actions Column -->
                            <div class="col-md-2">
                                <div class="d-flex flex-column">
                                    <a href="{% url 'learning_path:step_edit' learning_path.id step.id %}" class="btn btn-outline-primary mb-2 w-100">
                                        <i class="fas fa-edit"></i> Edit
                                    </a>
                                    <form action="{% url 'learning_path:step_delete' learning_path.id step.id %}" method="post">
                                        {% csrf_token %}
                                        <button type="submit" class="btn btn-outline-danger w-100">
                                            <i class="fas fa-trash-alt"></i> Delete
                                        </button>
                                    </form>
                                </div>
                            </div>
                        {% empty %}
                            <p class="text-muted">No courses available for this step.</p>
                        {% endfor %}
                    </div>
                </li>
            {% empty %}
                <p class="text-center">No steps available for this learning path.</p>
            {% endfor %}
        </ol>
    </div>
</div>

{% endblock %}
